{% extends "base.html" %}

{% block head %}
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css')}}">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
{% endblock %}

{% block title %}
Main
{% endblock %}

{% block content %}
<form action="/delete" method="POST">
    <button type="submit">Delete All</button>
</form>
<div class="login-container">
    <h2>Add your course</h2>
    <form id="courseForm" method="POST">
        {{ form.hidden_tag() }}
        <div class="form-group">
            <!-- renders the label and input field -->
            {{ form.course_code.label() }}
            {{ form.course_code() }}
        </div>
        <div class="form-group">
            {{ form.add() }}
        </div>
    </form>
</div>

<div class="content-container">
    <div class="course_container">
        <h2>Your Courses</h2>
        <!-- ul is a HTML element to represent an unordered list, li is list item -->
        <ul>
            {% for course in user_courses %}
            <li>{{ course.course_code }}</li>
            {% endfor %}
        </ul>
    </div>

    <div>

        <div class="timetable-container">
            <table id="timetable">
                <thead>
                    <tr>
                        <th>Time</th>
                        {% for day in ['MON', 'TUE', 'WED', 'THU', 'FRI'] %}
                            <th>{{ day }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for time_slot in schedule %}
                        <tr>
                            <td>{{ time_slot }}</td>
                            {% for day in ['MON', 'TUE', 'WED', 'THU', 'FRI'] %}
                                <td>
                                    {% set day_schedule = weekly_schedules.get(day, {}).get(time_slot, []) %}
                                    {% for class in day_schedule %}
                                        Type: {{ class['type'] }},
                                        Course Index: {{ class['index'] }},
                                        Group: {{ class['group'] }},
                                        Venue: {{ class['venue'] }},
                                        Remarks: {{ class.get('remarks', '') }}<br>
                                    {% endfor %}
                                    {% if day_schedule|length == 0 %}
                                        <!-- Empty cell for no class -->
                                    {% endif %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
    </div>

    {% endblock %}

    {% block scripts %}
    <script type="text/javascript">
        // Ready is a function to only run the code after form is submitted
        $(document).ready(function () {
            $('#courseForm').on('submit', function (e) { // Listens for a form id courseForm to be submitted
                e.preventDefault(); // pass the form to ajax

                $.ajax({    // A http method without the need to reload the page
                    url: 'main',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (response) {
                        if (response.status === 'error') {
                            showModal(response.message);
                        }
                        if (response.status === 'success') {
                            location.reload();
                            $('ul').append('<li>' + response.new_course + '</li>');
                            $('#courseForm input[name="course_code"]').val('');
                        }
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            });
        });

    </script>
    {% endblock %}